<% if customer_signed_in? %>
  <div class="container mt-4">
    <h2 class="mb-4"><strong>Order Confirmation</strong></h2>
    
    <!-- Customer Details Card -->
    <div class="card mb-4">
      <div class="card-header">
        <h4><strong>Customer Details</strong></h4>
      </div>
      <div class="card-body">
        <p class="mb-2"><strong>Name: </strong><%= current_customer.name %></p>
        <p class="mb-2"><strong>Email: </strong><%= current_customer.email %></p>
        <p class="mb-2"><strong>Address: </strong><%= current_customer.address %></p>
        <p class="mb-2"><strong>Province: </strong><%= current_customer.province.name %></p>
      </div>
    </div>

    <!-- Order Details Card -->
    <div class="card">
      <div class="card-header">
        <h4><strong>Order Details</strong></h4>
      </div>
      <div class="card-body">
        <!-- Table Header Row -->
        <div class="row mb-2">
          <div class="col-3"><strong>Product Name</strong></div>
          <div class="col-2"><strong>Qty</strong></div>
          <div class="col-3"><strong>Unit Price</strong></div>
          <div class="col-2"><strong>Total</strong></div>
        </div>
        
        <% total_cart_price = 0 %>
        <% @cart.each do |item| %>
          <% product = Product.find_by(name: item[:name]) %>
          <% total_price_for_item = item[:price] * item[:quantity] %>
          <% total_cart_price += total_price_for_item %>
          <!-- Item Row -->
          <div class="row border-bottom mb-3 align-items-center">
            <div class="col-3"><%= item[:name] %></div>
            <div class="col-2"><%= item[:quantity] %></div>
            <div class="col-3">$<%= '%.2f' % item[:price] %></div>
            <div class="col-2">$<%= '%.2f' % total_price_for_item %></div>
          </div>
        <% end %>
        
        <!-- Order Summary -->
        <div class="row mt-3">
          <div class="col-12">
            <p class="mb-1"><strong>Cart Subtotal:</strong> $<%= '%.2f' % total_cart_price %></p>
            <p class="mb-1"><strong>Tax (<%= current_customer.province.tax_rate * 100 %>%):</strong> $<%= '%.2f' % (total_cart_price * current_customer.province.tax_rate) %></p>
            <p class="mb-1"><strong>Cart Total:</strong> $<%= '%.2f' % (total_cart_price * (1 + current_customer.province.tax_rate)) %></p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Proceed to Payment Button -->
    <div class="row mt-4">
      <div class="col-12 d-flex justify-content-end">
        <%= button_to "Proceed to Payment", checkout_create_path, method: :post, class: "btn btn-primary" %>
        <% if customer_signed_in? && session[:cart].present? %>
          <%= button_to 'Complete Order', complete_order_path, method: :post, class: 'btn btn-success' %>
        <% end %>
      </div>
    </div>
  </div>
<% else %>
  <p>Please sign in to view your order confirmation.</p>
<% end %>